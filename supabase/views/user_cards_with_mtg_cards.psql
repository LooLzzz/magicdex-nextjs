-- DROP VIEW user_cards_with_mtg_cards

CREATE OR REPLACE VIEW user_cards_with_mtg_cards AS
    SELECT user_cards.*, mtg_cards.all_parts,mtg_cards.arena_id,mtg_cards.artist,mtg_cards.artist_id,mtg_cards.artist_ids,mtg_cards.attraction_lights,mtg_cards.booster,mtg_cards.border_color,mtg_cards.card_back_id,mtg_cards.card_faces,mtg_cards.cardmarket_id,mtg_cards.cmc,mtg_cards.collector_number,mtg_cards.color_identity,mtg_cards.color_indicator,mtg_cards.colors,mtg_cards.content_warning,mtg_cards.defense,mtg_cards.digital,mtg_cards.edhrec_rank,mtg_cards.finishes,mtg_cards.flavor_text,mtg_cards.frame,mtg_cards.frame_effects,mtg_cards.full_art,mtg_cards.games,mtg_cards.hand_modifier,mtg_cards.highres_image,mtg_cards.illustration_id,mtg_cards.image_status,mtg_cards.keywords,mtg_cards.lang,mtg_cards.layout,mtg_cards.legalities,mtg_cards.life_modifier,mtg_cards.loyalty,mtg_cards.mana_cost,mtg_cards.mtgo_foil_id,mtg_cards.mtgo_id,mtg_cards.multiverse_ids,mtg_cards.name,mtg_cards.nonfoil,mtg_cards.object,mtg_cards.oracle_id,mtg_cards.oracle_text,mtg_cards.oversized,mtg_cards.penny_rank,mtg_cards.power,mtg_cards.preview,mtg_cards.prints_search_uri,mtg_cards.produced_mana,mtg_cards.promo,mtg_cards.promo_types,mtg_cards.rarity,mtg_cards.related_uris,mtg_cards.released_at,mtg_cards.reprint,mtg_cards.reserved,mtg_cards.rulings_uri,mtg_cards.scryfall_set_uri,mtg_cards.scryfall_uri,mtg_cards.security_stamp,mtg_cards.set,mtg_cards.set_id,mtg_cards.set_name,mtg_cards.set_search_uri,mtg_cards.set_type,mtg_cards.set_uri,mtg_cards.story_spotlight,mtg_cards.tcgplayer_etched_id,mtg_cards.tcgplayer_id,mtg_cards.textless,mtg_cards.toughness,mtg_cards.type_line,mtg_cards.uri,mtg_cards.variation,mtg_cards.watermark,mtg_cards.image_uris,mtg_cards.flavor_name,mtg_cards.purchase_uris,mtg_cards.prices,mtg_cards.printed_name,mtg_cards.printed_text,mtg_cards.printed_type_line,mtg_cards.variation_of,case when user_cards.foil then mtg_cards.prices->'usd_foil' else mtg_cards.prices->'usd' end as price_usd
    FROM user_cards
    LEFT JOIN mtg_cards ON user_cards.scryfall_id = mtg_cards.id;

ALTER VIEW user_cards_with_mtg_cards SET (security_invoker = on);
